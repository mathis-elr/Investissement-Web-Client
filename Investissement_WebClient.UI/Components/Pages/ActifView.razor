
@using Investissement_WebClient.Data.Modeles
@using Investissement_WebClient.UI.Components.ViewsModels;

@page "/actif"
@rendermode InteractiveServer
@inject IJSRuntime JS
@inject ActifViewModel AVM

<PageTitle>Actif</PageTitle>

<div class="actif">
    <div class="ajout-edit-actif">
        <div class="choix-ajout-edit-actif">
            <div class="mode-ajout @(AVM.selectedMode == "Ajouter" ? "selected" : "")" @onclick="AVM.ChangeMode">
                <label>Ajouter</label>
            </div>
            <div class="mode-edit @(AVM.selectedMode == "Modifier" ? "selected" : "")" @onclick="AVM.ChangeMode">
                <label>Modifier</label>
            </div>
        </div>
        
        @switch (AVM.selectedMode)
        {
            case "Ajouter":
                <div class="ajout-actif">
                    <div class="ajout-actif-header">
                        <label>Disponibles :</label>
                        <select @bind="AVM.NomActifSelectionne">
                        <option>Aucun</option>
                            @foreach (ActifModele actif in AVM.ListeActifs)
                            {
                                <option>@actif.nom</option>
                            }
                        </select>
                    </div>
                    <div class="ajout-actif-content">
                        <input type="text" @bind="AVM.actifSelectionne.nom" placeholder="Nom"/>
                        <input type="text" @bind="AVM.actifSelectionne.type" placeholder="Type"/>
                        <input type="text" @bind="AVM.actifSelectionne.isin" placeholder="ISIN"/>
                        <input type="text" @bind="AVM.actifSelectionne.symbole" placeholder="Symbole"/>
                        <select @bind="AVM.selectedNvRisque">
                            <option disabled selected>Niveau de risque</option>
                            @foreach (string item in AVM.ListeNvRisque)
                            {
                                <option>@item</option>
                            }
                        </select>
                    </div>

                    <div class="ajout-actif-footer">
                        <button class="btn-ajout" @onclick="Ajouter">Ajouter</button>
                    </div>
                </div>

                break;

            case "Modifier":
                <div class="edit-actif-header">
                    <label>Enregistrés </label>
                    <select @bind="AVM.SelectedActifEdit">
                        <option>Aucun</option>
                        @foreach (var actif in AVM.ListeNomsActifs)
                        {
                            <option value="@actif">@actif</option>
                        }
                    </select>
                </div>
                <div class="edit-actif-content">
                    @if (AVM.SelectedActifEdit != "Aucun")
                    {
                        <input disabled type="text" @bind="AVM.selectedNomEdit" placeholder="Nom"/>
                        <input type="text" @bind="AVM.selectedSymboleEdit" placeholder="Symbole"/>
                        <input type="text" @bind="AVM.selectedTypeEdit" placeholder="Type"/>
                        <input type="text" @bind="AVM.selectedISINEdit" placeholder="ISIN"/>
                        <select @bind="AVM.selectedNvRisqueEdit">
                            @foreach (var item in AVM.ListeNvRisque)
                            {
                                <option>@item</option>
                            }
                        </select>
                    }
                </div>
                <div class="edit-actif-footer">
                    @if (AVM.SelectedActifEdit != "Aucun")
                    {
                        <button class="btn-edit" @onclick="Editer">Modifier</button>
                    }
                </div>
                break;
        }
    </div>
    
    <div class="mes-actif">
        <div class="mes-actif-header">
            <label>Actifs enregistrés</label>
        </div>
        
        <div class="mes-actif-content">
            @foreach (var actif in AVM.ListeActifsEnregistre)
            {
                <span type="text" class="un-actif @(AVM.ListeActifASuppr.Contains(actif.nom) ? "active" : null)" @onclick="() => AVM.ChangerEtatSuppression(actif.nom)">@actif.nom</span>
            }
        </div>

        @if (AVM.ListeActifASuppr.Count != 0)
        {
            <div class="mes-actif-footer">
                <button class="btn-suppr" @onclick="() => Supprimer()">Supprimer</button>
            </div>
        }
    </div>
</div>

@code{

    async Task Ajouter()
    {
        AVM.Ajouter();

        if (AVM.hasError)
        {
            await JS.InvokeVoidAsync("alert", AVM.errorMessage);
        }
    }

    async Task Editer()
    {
        AVM.Editer();

        if (AVM.hasError)
        {
            await JS.InvokeVoidAsync("alert", AVM.errorMessage);
        }
        else
        {
            await JS.InvokeVoidAsync("alert", "Actif modifié avec succès");
        }
    }

    async Task Supprimer()
    {
        if (await JS.InvokeAsync<bool>("confirm", "Voulez-vous vraiment supprimer cet actif ?"))
        {
            AVM.Supprimer();

            if (AVM.hasError)
            {
                await JS.InvokeVoidAsync("alert", AVM.errorMessage);
            }
        }
    }
}